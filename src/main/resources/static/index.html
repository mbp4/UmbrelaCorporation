<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visualización de Datos de Cáncer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #1E293B;
      color: #ffffff;
    }

    .btn {
      @apply bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition ease-in-out duration-200;
    }

    #chartContainer {
      @apply max-w-4xl mx-auto my-8 p-6 bg-gray-800 shadow-lg rounded-lg;
    }

    .loader {
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-left-color: #3B82F6;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    canvas {
      display: block;
      width: 100% !important;
      height: 300px !important;
    }
  </style>
</head>
<body>

<div class="container mx-auto text-center">
  <h1 class="text-4xl font-semibold mb-6 text-blue-400">Visualización de Datos de Cáncer de Mama</h1>
  <div class="flex justify-center space-x-4">
    <button id="loadDataBtn" class="btn">Cargar Datos</button>
    <button id="stopDataBtn" class="btn bg-red-500 hover:bg-red-700">Detener Datos</button>
  </div>

  <div id="chartContainer" class="hidden">
    <canvas id="chart"></canvas>
  </div>

  <div id="loader" class="loader mx-auto mt-8 hidden"></div>
</div>

<script>
  // Inicializar gráfico
  const ctx = document.getElementById('chart').getContext('2d');
  let chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'Valores Generados',
        data: [],
        borderColor: 'rgba(75, 192, 192, 1)',
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        borderWidth: 2,
        pointBackgroundColor: 'rgba(255, 99, 132, 1)', //Color de los puntos del grafico
        pointBorderColor: 'rgba(255, 255, 255, 1)', //Contorno de los puntos
        pointHoverRadius: 7, //Modificación cuando pasas el ratón por encima
        pointHoverBackgroundColor: 'rgba(255, 206, 86, 1)',
        pointHoverBorderColor: 'rgba(220, 220, 220, 1)',
        fill: true,
        tension: 0.4, // Líneas suavizadas
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: true,
          labels: {
            color: '#ffffff',
            font: {
              size: 16,
            }
          }
        },
        tooltip: {
          backgroundColor: 'rgba(30, 41, 59, 0.8)', // Fondo oscuro para tooltips
          titleColor: '#ffffff',
          bodyColor: '#ffffff',
          callbacks: {
            label: function(tooltipItem) {
              return `Valor: ${tooltipItem.formattedValue}`;
            }
          }
        }
      },
      scales: {
        x: {
          grid: {
            color: 'rgba(255, 255, 255, 0.2)',
          },
          ticks: {
            color: '#ffffff',
            font: {
              size: 14,
            }
          }
        },
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(255, 255, 255, 0.2)',
          },
          ticks: {
            color: '#ffffff',
            font: {
              size: 14,
            }
          }
        }
      }
    }
  });

  //Función para actualizar el gráfico con los datos obtenidos del backend
  function updateChart() {
    fetch('/data')
            .then(response => response.json())
            .then(data => {
              chart.data.labels = data.map((_, index) => index + 1); //Índice de las etiquetas de los datos
              chart.data.datasets[0].data = data; //Cargar los valores
              chart.update(); //Actualizar gráfico
            });
  }

  //Mostrar el gráfico y cargar los datos al hacer clic en el botón
  document.getElementById('loadDataBtn').addEventListener('click', () => {
    document.getElementById('chartContainer').classList.remove('hidden');
    document.getElementById('loader').classList.remove('hidden');
    fetch('/start')
            .then(() => {
              updateChart();
              setInterval(updateChart, 1000); //Actualizar cada segundo
              document.getElementById('loader').classList.add('hidden');
            });
  });

  //Detener la generación de datos
  document.getElementById('stopDataBtn').addEventListener('click', () => {
    fetch('/stop');
    console.log("Generación de datos detenida.");
  });
</script>
</body>
</html>
